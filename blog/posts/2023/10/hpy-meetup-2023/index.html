<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HPy meetup and CPython core dev sprint in Brno (Oct 7-10, 2023) | HPy</title>
<link href="../../../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../../../rss.xml">
<link rel="canonical" href="https://hpyproject.org/blog/posts/2023/10/hpy-meetup-2023/">
<link rel="icon" href="../../../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../../../../assets/css/tipuesearch.css">
<meta name="author" content="fangerer">
<link rel="prev" href="../../../2022/09/hpy_sprint_2022_report/" title="HPy Sprint Status Update and Feedback Session" type="text/html">
<link rel="next" href="../hpy-0.9.0-fourth-public-release/" title="hpy 0.9.0: Fourth public release" type="text/html">
<meta property="og:site_name" content="HPy">
<meta property="og:title" content="HPy meetup and CPython core dev sprint in Brno (Oct 7-10, 2023)">
<meta property="og:url" content="https://hpyproject.org/blog/posts/2023/10/hpy-meetup-2023/">
<meta property="og:description" content="We just ended our rather informal HPy meetup in Brno (Czech Republic) which
started on Saturday (October 7th) and lasted until Tuesday (October 10th).
The main topics of the HPy meetup were:

The CPyt">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-10-10T10:00:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
        <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../../../index.html">
                    <image id="toplogo" src="../../../../../images/hpy-logo.svg" width="75px;" alt="HPy/"></image></a>
            </div>
            <div class="nav-container-1">
                    <div class="searchform" role="search">
                        
<form class="navbar-form navbar-left" action="../../../../../search/index.html" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Search…" autocomplete="off">
</div>
</form>

                    </div>
                <nav><ul class="nav-list">
<li> <a href="https://hpy.readthedocs.io/">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../../../blog">Index</a> </li>  
                    <li> <a href="../../../../../categories">Tags</a> </li>  
                    <li> <a href="../../../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../../../rss.xml">RSS feed</a> </li>  
                </ul>
</li>

                    </ul></nav><div class="nav-mobile">
                    <a id="nav-toggle" href="#!"> <span></span></a>
                </div>
            </div>
        </div>
    </section></header><div id="container">
         <main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">HPy meetup and CPython core dev sprint in Brno (Oct 7-10, 2023)</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../../../authors/fangerer/">fangerer</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-10-10T10:00:00Z" itemprop="datePublished" title="2023-10-10 10:00">2023-10-10 10:00</time></a>
            </p>
                <p class="commentline">            <a href="#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <p>We just ended our rather informal HPy meetup in Brno (Czech Republic) which
started on Saturday (October 7th) and lasted until Tuesday (October 10th).</p>
<p>The main topics of the HPy meetup were:</p>
<ul>
<li>The CPython Core Dev Sprint</li>
<li>Cython/HPy</li>
</ul>
<!--TEASER_END--><h2 id="the-cpython-core-dev-sprint">The CPython Core Dev Sprint<a href="#the-cpython-core-dev-sprint" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>Petr Viktorin, one of the CPython core developers, invited us to
partially attend the CPython core developer sprint. As a part of the sprint, he
organized a C API Summit Monday where we were invited and happily attended this
event.</p>
<p>Besides of lots of discussions, there were also very interesting presentations
about the C API:</p>
<h3 id="1-c-api-work-group-summary">1. C API Work Group Summary<a href="#1-c-api-work-group-summary" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>Irit
<a href="https://github.com/iritkatriel/talks/blob/main/2023_Sprint_Brno_C_API.pdf">presented</a>
the current status of the <a href="https://github.com/capi-workgroup">C API Work Group GitHub</a>
organisation. The idea of this GitHub org was to gather curent
<a href="https://github.com/capi-workgroup/problems">problems</a> of the C API and also to
collect ideas for the (re-)volution of the API. Irit thankfully went over all
issues and discussions to structure and summarize them. She identified nine
categories for problems:</p>
<ol>
<li>API Evolution and Maintenance</li>
<li>API Specification and Abstraction</li>
<li>Object Reference Management</li>
<li>Type Definition and Object Creation</li>
<li>Error Handling</li>
<li>API Tiers and Stability Guarantees</li>
<li>The C Language</li>
<li>Implementation Flaws</li>
<li>Missing Functionality</li>
</ol>
<p>She also mentioned strengths of the C API which the people contributing to the repository
agree on:</p>
<ul>
<li>Heap types</li>
<li>APIs taking a C string to look up based on Python strings</li>
<li>Limited API and Stable ABI</li>
</ul>
<p>Now, the idea is to write an <em>Informational PEP</em> and then to create:</p>
<ol>
<li>A process for discussions about replacement APIs</li>
<li>Guidelines for <a href="https://github.com/capi-workgroup/api-evolution">evolution of the C API</a>.</li>
</ol>
<p>The <a href="https://github.com/python/peps/pull/3491">PEP draft</a> is already available.</p>
<h3 id="2-petrs-vision-for-the-c-api">2. Petr's Vision for the C API<a href="#2-petrs-vision-for-the-c-api" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>Petr presented his understanding of how the C API should look in future. The
<a href="https://drive.google.com/file/d/148NLRPXGZGI1SXfKLMFvQc_iv67hPJQS/view?usp=sharing">slides</a>
for his talk are public. He made seven suggestions:</p>
<ol>
<li>
<p><em>Split</em> API from ABI so you can compile the API that it would use different ABI
   variants.</p>
</li>
<li>
<p><em>Consistency</em>: The API should have a consistent behavior. E.g. APIs should
   not return borrowed references and the exception behavior should be clear by the
   naming convention.</p>
</li>
<li>
<p><em>Versioning</em>: Essentially, a C extension should include the ABI version it
   was compiled with.</p>
</li>
<li>
<p><em>Errors</em>: All API functions must be able to signal an error that can be
   handled.</p>
</li>
<li>
<p><em>Concrete types</em>: The API should provide dedicated C types for certain
   built-in objects to have type safety already at the C language level.</p>
</li>
<li>
<p><em>Blueprint structures</em>: Creating types and objects should rather be done by
   using specifications than by allocating empty objects and filling them with
   content. Just think of <code>PyType_Spec</code> or <code>PyModuleDef</code>.</p>
</li>
<li>
<p><em>Context argument</em>: Every API function should have a context argument.</p>
</li>
</ol>
<p>Except for points 4 and 5, these goals are very close to HPy's. We, the
HPy team, have to say that this sounds very good and we would be happy to see
that in CPython.</p>
<h3 id="3-hpys-lessons-learned">3. HPy's Lessons Learned<a href="#3-hpys-lessons-learned" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>We were also asked to give a <a href="../../../../../talks/2023/10/things_to_learn_from_hpy.pdf">talk</a>
and to concentrate in the talk on two things:</p>
<ol>
<li>How do handles affect the API, and</li>
<li>What is the reason for the HPy context to contain the function table.</li>
</ol>
<p>We didn't <em>advertise</em> HPy in our talk but we talked about why opaque handles
are not only useful but sometimes necessary and how the API would change
compared to having only <code>PyObject *</code>.
We further showed that having the function table in the context gives us a lot
of flexibility and finally enables us to switch on the debug mode essentially at
run time (when an extension is loaded).</p>
<p>We are not sure if we managed to convince everyone that those concepts are useful.
The biggest problem is that introducing handles and a context argument will
radically change the API and require changes in many libraries (see also
<a href="https://github.com/capi-workgroup/api-revolution/issues/2">C API Workgroup - API Revolution #2</a>
and <a href="https://github.com/capi-workgroup/api-revolution/issues/7">C API Workgroup - API Revolution #7</a>).</p>
<h3 id="4-python-c-api-past-present-and-future">4. Python C API: Past, Present, and Future<a href="#4-python-c-api-past-present-and-future" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>Victor did a thorough <a href="https://github.com/vstinner/talks/blob/main/2023-CoreDevSprint-Brno/c-api.pdf">presentation</a>
of the past, present, and (possible) future of the Python C API. He pointed out
some past and present problems and gave some impression of its complexity. Victor
also suggests to make the stable ABI be the default. Overall, he sees a
positive trend in how the C API evolves.</p>
<h2 id="discussions">Discussions<a href="#discussions" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>We had a lot of good discussions and probably the most important one was about
the <a href="https://peps.python.org/pep-0703/">PEP 703 (noGIL)</a> implementation and the
new version of ABI (abi4) that is planned to be compatible with both noGIL and
GIL builds of CPython. In order to achieve that, Sam, the author of PEP
703, plans to make <code>PyObject *</code> opaque (so it will narrow to the semantics of a
handle) and also, the <code>Py_INCREF</code> will, in some cases, use an indirection over a
function pointer to actually call the incref logic. This is, again, a big step
forward for alternative implementations.</p>
<h2 id="cythonhpy">Cython/HPy<a href="#cythonhpy" class="headerlink" title="Permalink to this heading">¶</a></h2>
<p>Besides the main focus on the C API Summit at the CPython Core Dev Sprint, we
were also hacking a bit on Cython/HPy and made the doctest system work.
The problem there was that the doctest module is binding functions to self in
order to get a method but HPy did not yet provide the necessary slot
<code>HPy_tp_descr_get</code> for that. So, we've implemented that and will include it in
the next (minor) release.</p>
<p>We hoped that we would do more hacking on HPy itself but the CPython core dev
sprint was worth to spend our time too.</p>
      </div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../../2022/09/hpy_sprint_2022_report/" rel="prev" title="HPy Sprint Status Update and Feedback Session">Previous post</a>
            </li>
            <li class="next">
                <a href="../hpy-0.9.0-fourth-public-release/" rel="next" title="hpy 0.9.0: Fourth public release">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                      <div data-title="HPy meetup and CPython core dev sprint in Brno (Oct 7-10, 2023)" id="utterances-thread"></div>
        <script src="https://utteranc.es/client.js" repo="hpyproject/hpyproject.org" issue-term="title" label="Comments" theme="github-light" crossorigin="anonymous"></script></section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The HPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/hpyproject/hpyproject.github.io/">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/blog/posts/2023/10/hpy-0.9.0-fourth-public-release/" class="listtitle">hpy 0.9.0: Fourth public release</a>
      </li>
      <li>
        <a href="/blog/posts/2023/10/hpy-meetup-2023/" class="listtitle">HPy meetup and CPython core dev sprint in Brno (Oct 7-10, 2023)</a>
      </li>
      <li>
        <a href="/blog/posts/2022/09/hpy_sprint_2022_report/" class="listtitle">HPy Sprint Status Update and Feedback Session</a>
      </li>
      <li>
        <a href="/blog/posts/2022/09/hpy_on_graal_and_mpl/" class="listtitle">HPy on GraalPy and Matplotlib/HPy</a>
      </li>
      <li>
        <a href="/blog/posts/2022/07/dusseldorf-sprint-2022/" class="listtitle">Dusseldorf PyPy/HPy/other sprint Sept 19-23, 2022</a>
      </li>
      <li>
        <a href="/blog/posts/2022/06/hpy-0.0.4-third-public-release/" class="listtitle">hpy 0.0.4: Third public release</a>
      </li>
      <li>
        <a href="/blog/posts/2021/10/hpy-0.0.3-second-public-release/" class="listtitle">hpy 0.0.3: Second public release</a>
      </li>
      <li>
        <a href="/blog/posts/2021/07/hpy-0.0.2-first-public-release/" class="listtitle">hpy 0.0.2: First public release</a>
      </li>
      <li>
        <a href="/blog/posts/2021/05/hpy-irc-moves-to-libera-chat/" class="listtitle">#hpy IRC moves to Libera.Chat</a>
      </li>
      <li>
        <a href="/blog/posts/2021/05/hpy-python-language-summit/" class="listtitle">HPy @ Python Language Summit</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2021/">2021</a> (6)
            </li>
            <li><a class="reference" href="/2022/">2022</a> (4)
            </li>
            <li><a class="reference" href="/2023/">2023</a> (2)
            </li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../../../images/hpy-logo.svg" alt="PyPy Logo">
</div>
  <div class="logotext">
     Contents © 2024 <a href="mailto:hpy-dev@python.org">The HPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="../../../../../rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>